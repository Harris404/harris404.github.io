# Excel 截图与图片嵌入插件

这是一个功能强大的 Excel Office 加载项，提供截图粘贴、批量图片嵌入和单元格图片预览功能。

## 🎯 功能特点

### 功能一：截图粘贴与拖拽
- 支持从剪贴板粘贴截图（Ctrl+V / Cmd+V）
- 支持拖拽图片文件到插件面板
- **预览确认**：插入前可预览图片，确认后才插入到选定单元格
- 图片自动适应单元格大小，跟随单元格移动和缩放

### 功能二：批量图片嵌入
- 支持同时选择多个单元格
- 批量选择多张图片文件
- 一键按顺序将图片嵌入到单元格
- 支持预览和删除已选图片
- 自动调整图片位置和大小

### 功能三：单元格图片预览
- 获取选中单元格范围内的图片
- 小图预览列表，点击可查看大图
- 支持键盘导航（←→方向键）和删除（Delete键）
- **原图保存**：自动保存原始高清图片，预览时显示原图质量

## 📋 系统要求

- **Microsoft Excel 2016** 或更高版本（Windows/Mac）
- **Excel Online**（网页版）
- Node.js 14.x 或更高版本（仅开发需要）

> ⚠️ **注意**：本插件仅支持 Microsoft Office，不支持 WPS Office

## 🚀 快速开始

### 方式一：使用在线版本（推荐）

1. 下载 `manifest.xml` 文件
2. 在 Excel 中加载插件（见下方说明）

### 方式二：本地开发

#### 安装依赖

```bash
npm install
```

#### 开发模式

```bash
npm run dev
```

服务器将在 https://localhost:3000 启动

#### 构建生产版本

```bash
npm run build
```

构建产物将输出到 `dist` 文件夹

## 📥 在 Excel 中加载插件

### Windows

1. 打开 Excel，进入 **插入** > **加载项** > **获取加载项**
2. 点击 **我的加载项** > **共享文件夹** 或 **上传我的加载项**
3. 选择 `manifest.xml` 文件
4. 点击 **确定**

### macOS

1. 打开 Excel，进入 **插入** > **加载项** > **我的加载项**
2. 点击右上角 **⋯** > **上传我的加载项**
3. 选择 `manifest.xml` 文件
4. 点击 **上传**

### Excel Online

1. 打开 Excel Online，进入 **插入** > **Office 加载项**
2. 点击 **上传我的加载项**
3. 选择 `manifest.xml` 文件

## 📖 使用说明

### 功能一：截图粘贴

1. 使用系统截图工具截取屏幕（Windows: Win+Shift+S, Mac: Cmd+Shift+4）
2. 在 Excel 中选择目标单元格
3. 在插件的粘贴区域按 **Ctrl+V**（Mac: Cmd+V）粘贴，或直接拖拽图片
4. 预览图片，点击 **确认插入** 或 **取消**
5. 图片将嵌入到选定的单元格中

### 功能二：批量图片嵌入

1. 在 Excel 中选择多个单元格（数量与图片数量一致）
2. 点击 **选择图片** 按钮，选择多张图片
3. 在预览区查看已选图片，可点击 × 删除不需要的图片
4. 点击 **批量嵌入** 按钮
5. 图片将按顺序嵌入到选中的单元格中

### 功能三：查看单元格图片

1. 选择包含图片的单元格范围
2. 点击 **获取图片** 按钮
3. 小图列表中点击任意图片可查看大图
4. 使用 **←** **→** 方向键切换图片
5. 按 **Delete** 键可删除当前图片

## 🛠️ 技术栈

- **TypeScript** - 类型安全的 JavaScript
- **Office.js** - Microsoft Office JavaScript API
- **Webpack** - 模块打包工具
- **Clipboard API** - 剪贴板读取
- **HTML5 Drag & Drop** - 拖拽上传

## 📁 项目结构

```
jietu/
├── src/
│   ├── taskpane/
│   │   ├── taskpane.html    # 任务窗格界面
│   │   └── taskpane.ts      # 任务窗格逻辑
│   └── commands/
│       ├── commands.html    # 命令页面
│       └── commands.ts      # 命令逻辑
├── dist/                    # 构建输出目录
├── assets/                  # 图标资源
├── manifest.xml            # 本地开发清单
├── manifest.github-pages.xml # GitHub Pages 部署清单
├── package.json           # 项目配置
├── tsconfig.json         # TypeScript 配置
├── webpack.config.js     # Webpack 配置
└── README.md            # 项目文档
```

## 🔧 故障排除

### 问题：无法加载插件

**解决方案：**
- 确保使用的是 Microsoft Excel（不支持 WPS）
- 检查 manifest.xml 文件路径是否正确
- 尝试重启 Excel

### 问题：粘贴截图不工作

**解决方案：**
- 确保先点击粘贴区域使其获得焦点
- 检查剪贴板中是否有图片内容
- 尝试使用拖拽方式上传图片

### 问题：图片无法嵌入

**解决方案：**
- 检查图片格式是否支持（推荐 PNG、JPG、GIF）
- 确保选择的单元格数量与图片数量匹配
- 查看浏览器控制台（F12）检查错误信息

### 问题：获取图片为空

**解决方案：**
- 确保选中了包含图片的单元格
- 图片必须是通过本插件插入的（锚定到单元格）
- 尝试选择更大的单元格范围

## 🔒 安全性

- ✅ 所有图片处理都在本地进行
- ✅ 不会上传任何数据到外部服务器
- ✅ 原图数据保存在 Excel 文档内部
- ✅ 使用 HTTPS 加密通信

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交问题和功能请求！

---

**提示**：如遇到问题，请在浏览器开发者工具（F12）中查看控制台日志以获取详细错误信息。
